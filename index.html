<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delonix Airdrop Vault</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* --- THEME COLORS --- */
            --bg-dark: #0f172a; 
            --primary-grad: linear-gradient(135deg, #6200ea 0%, #304ffe 100%);
            --primary-solid: #304ffe;
            
            /* GLASS VARIABLES */
            --glass-panel: rgba(15, 23, 42, 0.65); 
            --glass-input: rgba(255, 255, 255, 0.05);
            --glass-card: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.1);
            
            --text-main: #ffffff;
            --text-muted: #94a3b8;
            --success: #00e676; 
            --danger: #ff1744;
            --warning: #fbbf24;
            --info: #38bdf8; /* Biru Langit (Link) */
            --purple: #c084fc; /* Ungu (Keyword) */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'JetBrains Mono', monospace; }

        body {
            min-height: 100vh;
            display: flex; justify-content: center; align-items: center; padding: 30px 20px;
            background-color: var(--bg-dark);
            /* BACKGROUND IMAGE */
            background-image: url('https://raw.githubusercontent.com/delonix007/cryptodelonix/refs/heads/main/bg.png'); 
            background-size: cover; background-position: center; background-attachment: fixed; background-repeat: no-repeat;
        }

        .container {
            width: 100%; max-width: 850px;
            background: var(--glass-panel);
            backdrop-filter: blur(40px) saturate(120%); -webkit-backdrop-filter: blur(40px) saturate(120%);
            border: 1px solid var(--glass-border); border-radius: 20px; padding: 50px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        header { text-align: center; margin-bottom: 45px; }
        .logo-box {
            width: 70px; height: 70px; margin: 0 auto 20px;
            background: var(--primary-grad); 
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            display: flex; align-items: center; justify-content: center;
            font-size: 32px; color: white;
            box-shadow: 0 10px 30px -5px rgba(98, 0, 234, 0.5);
        }
        h1 { font-size: 24px; font-weight: 700; color: var(--text-main); letter-spacing: 1px; text-transform: uppercase; }
        p { color: var(--text-muted); margin-top: 8px; font-size: 14px; }

        .input-group { margin-bottom: 40px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        .full-width { grid-column: span 2; }

        label { display: block; font-size: 12px; font-weight: 700; color: var(--text-muted); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }

        /* INPUT & TEXTAREA STYLE */
        input[type="text"], input[type="url"], select {
            width: 100%; 
            height: 54px; /* FIXED HEIGHT */
            padding: 0 20px; 
            background: var(--glass-input); border: 1px solid var(--glass-border); border-radius: 4px;
            color: var(--text-main); font-size: 14px; outline: none;
            transition: border-color 0.3s, background-color 0.3s;
        }
        
        textarea { 
            width: 100%; padding: 16px 20px;
            background: var(--glass-input); border: 1px solid var(--glass-border); border-radius: 4px;
            color: var(--text-main); font-size: 14px; outline: none;
            transition: border-color 0.3s, background-color 0.3s;
            resize: vertical; min-height: 80px; line-height: 1.5; 
        }

        input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.2); }
        
        input:focus, select:focus, textarea:focus {
            background: rgba(30, 41, 59, 0.6); border-color: #6200ea;
            box-shadow: 0 0 0 4px rgba(98, 0, 234, 0.2);
        }

        /* --- FIXED CHECKBOX STYLE --- */
        .checkbox-wrapper {
            display: flex; align-items: center; gap: 12px;
            background: var(--glass-input); 
            height: 54px; 
            padding: 0 20px;
            border-radius: 4px; 
            border: 1px solid var(--glass-border);
            transition: border-color 0.3s, background-color 0.3s;
            cursor: pointer;
            width: 100%;
            user-select: none;
        }
        
        .checkbox-wrapper:hover {
            background: rgba(30, 41, 59, 0.6); 
            border-color: #6200ea;
        }

        input[type="checkbox"] { 
            width: 18px; height: 18px; accent-color: #6200ea; cursor: pointer; 
            padding: 0; margin: 0; 
            appearance: auto;
        }
        
        .checkbox-label { 
            margin: 0; cursor: pointer; 
            font-size: 14px; 
            color: var(--text-main); 
            font-weight: 400;
            text-transform: none; 
            letter-spacing: 0;
        }

        select {
            appearance: none; -webkit-appearance: none; cursor: pointer;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='rgba(255,255,255,0.7)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: right 16px center; background-size: 16px; padding-right: 45px;
        }
        select option { background: #0f172a; color: white; padding: 10px; }

        /* BUTTON SUBMIT */
        .btn-save {
            width: 100%; padding: 20px; margin-top: 15px;
            background: var(--primary-grad); color: white; font-weight: 700; font-size: 16px; letter-spacing: 1px;
            border: none; cursor: pointer;
            clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
            filter: drop-shadow(0 10px 20px rgba(76, 29, 149, 0.4));
            transition: transform 0.2s, filter 0.2s;
        }
        .btn-save:hover { transform: translateY(-2px); filter: drop-shadow(0 15px 30px rgba(76, 29, 149, 0.7)); }
        .btn-save:active { transform: scale(0.98); }
        .btn-save:disabled { opacity: 0.7; cursor: wait; transform: none; background: #333; filter: none; }

        /* LIST & CARD */
        .section-header {
            display: flex; justify-content: space-between; align-items: center;
            margin: 50px 0 25px; padding-bottom: 20px; border-bottom: 1px solid var(--glass-border);
        }
        .section-title { font-size: 16px; font-weight: 700; color: var(--text-main); text-transform: uppercase; letter-spacing: 1px; }
        .badge-count { 
            background: rgba(255,255,255,0.05); padding: 5px 12px; border-radius: 4px; 
            color: var(--text-muted); font-size: 12px; font-weight: 600; border: 1px solid var(--glass-border); 
        }

        .grid-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }

        .card {
            background: var(--glass-card); border: 1px solid var(--glass-border); border-radius: 12px;
            padding: 24px; display: flex; flex-direction: column;
            transition: transform 0.3s, background 0.3s, border-color 0.3s;
        }
        .card:hover { transform: translateY(-5px); background: rgba(30, 41, 59, 0.6); border-color: #6200ea; }

        .card-top { display: flex; justify-content: space-between; margin-bottom: 12px; }
        .keyword-pill { 
            background: rgba(98, 0, 234, 0.15); color: #b388ff; padding: 6px 12px; 
            border-radius: 4px; font-size: 11px; font-weight: 700; border: 1px solid rgba(98, 0, 234, 0.3);
        }
        .status-badge { font-size: 11px; font-weight: 600; display: flex; align-items: center; color: var(--text-muted); }
        .st-Active { color: var(--success); }
        
        .card h3 { color: var(--text-main); margin-bottom: 8px; font-size: 16px; font-weight: 700; }
        .source { color: var(--text-muted); font-size: 13px; margin-bottom: 15px; display: flex; align-items: center; gap: 6px; }

        .notes-box {
            background: rgba(0, 0, 0, 0.2); border-left: 3px solid var(--primary-solid); padding: 10px;
            margin-bottom: 20px; border-radius: 4px; font-size: 12px; color: #e2e8f0; line-height: 1.4; white-space: pre-wrap; flex-grow: 1;
        }

        .action-row { display: flex; gap: 12px; margin-top: auto; }
        
        .btn-link {
            flex: 1; text-decoration: none; text-align: center;
            background: rgba(255,255,255,0.05); color: var(--text-main); padding: 12px; border-radius: 4px; 
            font-weight: 600; font-size: 13px; border: 1px solid var(--glass-border); transition: 0.2s;
        }
        .btn-link:hover { background: rgba(255,255,255,0.1); border-color: var(--primary-solid); }
        
        /* Icon Buttons */
        .btn-icon {
            width: 45px; height: 45px; flex-shrink: 0; border-radius: 4px; font-size: 16px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.2s; border: 1px solid transparent;
        }

        /* Tombol Delete (Merah) */
        .btn-delete { background: rgba(255, 23, 68, 0.1); color: #ff8a80; border-color: rgba(255, 23, 68, 0.2); }
        .btn-delete:hover { background: rgba(255, 23, 68, 0.25); border-color: var(--danger); color: white; }

        /* Tombol Edit Note (Kuning) */
        .btn-edit { background: rgba(251, 191, 36, 0.1); color: #fcd34d; border-color: rgba(251, 191, 36, 0.2); }
        .btn-edit:hover { background: rgba(251, 191, 36, 0.25); border-color: var(--warning); color: white; }

        /* Tombol Edit Link (Biru Langit) */
        .btn-edit-link { background: rgba(56, 189, 248, 0.1); color: #38bdf8; border-color: rgba(56, 189, 248, 0.2); }
        .btn-edit-link:hover { background: rgba(56, 189, 248, 0.25); border-color: var(--info); color: white; }

        /* Tombol Edit Keyword (Ungu) - BARU */
        .btn-edit-keyword { background: rgba(192, 132, 252, 0.1); color: #c084fc; border-color: rgba(192, 132, 252, 0.2); }
        .btn-edit-keyword:hover { background: rgba(192, 132, 252, 0.25); border-color: var(--purple); color: white; }

        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            .full-width { grid-column: span 1; }
            .container { padding: 30px 20px; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="logo-box"><i class="fas fa-cube"></i></div>
        <h1>Delonix Airdrop Vault</h1>
        <p>Private Automation Dashboard</p>
    </header>

    <div class="input-group">
        <form id="addForm">
            <div class="form-grid">
                <div class="full-width">
                    <label>Nama Project</label>
                    <input type="text" id="name" placeholder="Contoh: Avon Public Testnet" required>
                </div>
                <div>
                    <label>Keyword Bot</label>
                    <input type="text" id="keyword" placeholder="Contoh: Avon" required>
                </div>
                <div>
                    <label>Source ID</label>
                    <input type="text" id="source" placeholder="airdropfind" required>
                </div>
                <div class="full-width">
                    <label>Link Garapan</label>
                    <input type="url" id="link" placeholder="https://..." required>
                </div>
                <div class="full-width">
                    <label>Keterangan / Catatan (Opsional)</label>
                    <textarea id="notes" placeholder="Tulis info tambahan, misal: Wajib tx seminggu sekali..."></textarea>
                </div>
                
                <div>
                    <label>Status</label>
                    <select id="status">
                        <option value="Active">Active (Tracking Update)</option>
                        <option value="Done">Done (Arsip)</option>
                    </select>
                </div>

                <div>
                    <label>Reminder</label>
                    <label class="checkbox-wrapper">
                        <input type="checkbox" id="dailyReminder">
                        <span class="checkbox-label">Aktifkan Reminder Harian?</span>
                    </label>
                </div>
            </div>

            <button type="submit" class="btn-save">
                <i class="fas fa-save" style="margin-right: 8px;"></i> SUBMIT
            </button>
        </form>
    </div>

    <div class="section-header">
        <span class="section-title">Monitoring List</span>
        <span class="badge-count" id="totalCount">0 Items</span>
    </div>
    
    <div id="gridList" class="grid-list">
        <div style="grid-column:1/-1; text-align:center; padding:60px; color:var(--text-muted);">
            <i class="fas fa-circle-notch fa-spin" style="font-size: 32px; color: var(--primary-solid);"></i>
            <br><br>Menghubungkan ke database...
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, collection, addDoc, deleteDoc, updateDoc, doc, onSnapshot, query, orderBy } 
    from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    // CONFIG FIREBASE KAMU
    const firebaseConfig = {
      apiKey: "AIzaSyDJwLno6mR7X1MNHyn3gRYagduOohmgcWQ",
      authDomain: "cryptodelonix.firebaseapp.com",
      projectId: "cryptodelonix",
      storageBucket: "cryptodelonix.firebasestorage.app",
      messagingSenderId: "265190187840",
      appId: "1:265190187840:web:86be6be1e4eac1aa70d0a5",
      measurementId: "G-BSSFE27WZ5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const q = query(collection(db, "airdrops"), orderBy("createdAt", "desc"));
    
    onSnapshot(q, (snapshot) => {
        const grid = document.getElementById('gridList');
        const badge = document.getElementById('totalCount');
        
        grid.innerHTML = ""; badge.innerText = snapshot.size + " Items";

        if(snapshot.empty){
            grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; padding:60px; color:var(--text-muted);">Belum ada data.</div>`;
            return;
        }

        snapshot.forEach((documentSnapshot) => {
            const data = documentSnapshot.data();
            const docId = documentSnapshot.id;
            const searchKey = data.search_keyword || data.name;

            const reminderIcon = data.isDailyReminder ? 
                `<i class="fas fa-bell" style="color:#fbbf24; margin-left:8px;" title="Daily Reminder"></i>` : '';

            const notesText = data.notes && data.notes.trim() !== "" ? data.notes : "Tidak ada keterangan.";
            const notesHtml = `<div class="notes-box"><i class="far fa-sticky-note" style="margin-right:5px; opacity:0.7;"></i> ${notesText}</div>`;

            const card = document.createElement('div');
            card.className = 'card';
            
            card.innerHTML = `
                <div class="card-top">
                    <span class="keyword-pill"><i class="fas fa-robot"></i> ${searchKey}</span>
                    <div class="status-badge ${data.status === 'Active'?'st-Active':''}">
                        <i class="fas fa-circle" style="font-size:6px; margin-right:6px;"></i> ${data.status}
                    </div>
                </div>
                
                <h3>${data.name} ${reminderIcon}</h3>
                <div class="source"><i class="fab fa-telegram-plane"></i> @${data.source}</div>

                ${notesHtml}
                
                <div class="action-row">
                    <a href="${data.link}" target="_blank" class="btn-link">
                        Buka <i class="fas fa-external-link-alt" style="margin-left:5px;"></i>
                    </a>
                </div>
            `;

            // 1. TOMBOL EDIT LINK (BIRU LANGIT)
            const editLinkBtn = document.createElement('button');
            editLinkBtn.className = 'btn-icon btn-edit-link';
            editLinkBtn.innerHTML = '<i class="fas fa-link"></i>';
            editLinkBtn.title = "Sunting Link";
            editLinkBtn.onclick = async () => {
                const currentLink = data.link || "";
                const newLink = prompt("Edit Link Garapan:", currentLink);
                if (newLink !== null) {
                    try {
                        await updateDoc(doc(db, "airdrops", docId), { link: newLink });
                    } catch (err) {
                        alert("Gagal update link: " + err.message);
                    }
                }
            };

            // 2. TOMBOL EDIT KEYWORD (UNGU - BARU)
            const editKeywordBtn = document.createElement('button');
            editKeywordBtn.className = 'btn-icon btn-edit-keyword';
            editKeywordBtn.innerHTML = '<i class="fas fa-tag"></i>'; // Ikon Tag untuk Keyword
            editKeywordBtn.title = "Sunting Keyword";
            editKeywordBtn.onclick = async () => {
                const currentKeyword = data.search_keyword || "";
                const newKeyword = prompt("Edit Keyword Bot:", currentKeyword);
                if (newKeyword !== null) {
                    try {
                        await updateDoc(doc(db, "airdrops", docId), { search_keyword: newKeyword.trim() });
                    } catch (err) {
                        alert("Gagal update keyword: " + err.message);
                    }
                }
            };

            // 3. TOMBOL EDIT NOTE (KUNING)
            const editBtn = document.createElement('button');
            editBtn.className = 'btn-icon btn-edit';
            editBtn.innerHTML = '<i class="fas fa-pen"></i>';
            editBtn.title = "Sunting Keterangan";
            editBtn.onclick = async () => {
                const currentNote = data.notes || "";
                const newNote = prompt("Edit Keterangan / Catatan:", currentNote);
                if (newNote !== null) {
                    try {
                        await updateDoc(doc(db, "airdrops", docId), { notes: newNote });
                    } catch (err) {
                        alert("Gagal update: " + err.message);
                    }
                }
            };

            // 4. TOMBOL DELETE (MERAH)
            const delBtn = document.createElement('button');
            delBtn.className = 'btn-icon btn-delete';
            delBtn.innerHTML = '<i class="far fa-trash-alt"></i>';
            delBtn.onclick = async () => {
                if(confirm(`Hapus ${data.name}?`)) await deleteDoc(doc(db, "airdrops", docId));
            };

            // Masukkan tombol ke action row (Urutan: Link -> Keyword -> Note -> Delete)
            const actionRow = card.querySelector('.action-row');
            actionRow.appendChild(editLinkBtn);
            actionRow.appendChild(editKeywordBtn);
            actionRow.appendChild(editBtn);
            actionRow.appendChild(delBtn);

            grid.appendChild(card);
        });
    });

    document.getElementById('addForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.querySelector('.btn-save');
        const originalHtml = '<i class="fas fa-save" style="margin-right: 8px;"></i> SUBMIT';
        
        btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> PROCESSING...'; 
        btn.disabled = true;

        try {
            await addDoc(collection(db, "airdrops"), {
                name: document.getElementById('name').value,
                search_keyword: document.getElementById('keyword').value.trim(),
                source: document.getElementById('source').value.replace('@','').trim(),
                link: document.getElementById('link').value,
                notes: document.getElementById('notes').value,
                status: document.getElementById('status').value,
                isDailyReminder: document.getElementById('dailyReminder').checked,
                createdAt: new Date(),
                last_message_snippet: "", tracked_msg_id: null 
            });
            
            e.target.reset();
            btn.innerHTML = '<i class="fas fa-check"></i> SUCCESS!';
            btn.style.background = "#00e676";
            
            setTimeout(() => {
                btn.innerHTML = originalHtml;
                btn.disabled = false;
                btn.style.background = ""; 
            }, 2000);

        } catch(err) { 
            alert("Error: " + err.message);
            btn.innerHTML = originalHtml;
            btn.disabled = false;
        }
    });
</script>

</body>
</html>
