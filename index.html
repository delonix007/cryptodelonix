<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airdrop Vault - Private</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* --- COLOR PALETTE --- */
            --primary-grad: linear-gradient(135deg, #3b82f6, #06b6d4);
            --primary-color: #3b82f6;
            
            /* GLASS VARIABLES */
            --glass-bg-main: rgba(15, 23, 42, 0.6); /* Lebih gelap dikit biar teks pop */
            --glass-bg-input: rgba(255, 255, 255, 0.05);
            --glass-bg-card: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            
            /* TEXT COLORS */
            --text-light: #ffffff;
            --text-dim: #94a3b8;
            --success: #22c55e;
            --danger: #ef4444;
            --danger-glass: rgba(239, 68, 68, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }

        body {
            min-height: 100vh;
            display: flex; justify-content: center; align-items: center; padding: 30px 20px;
            background-color: #0f172a;
            
            /* --- BACKGROUND IMAGE --- */
            /* GANTI URL DI BAWAH INI */
            background-image: url('https://raw.githubusercontent.com/delonix007/cryptodelonix/refs/heads/main/bg.png'); 
            
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
        }

        /* --- CONTAINER --- */
        .container {
            width: 100%; max-width: 850px;
            background: var(--glass-bg-main);
            backdrop-filter: blur(40px) saturate(150%);
            -webkit-backdrop-filter: blur(40px) saturate(150%);
            border: 1px solid var(--glass-border);
            border-radius: 32px;
            padding: 50px;
            box-shadow: var(--glass-shadow);
        }

        /* HEADER */
        header { text-align: center; margin-bottom: 40px; color: var(--text-light); }
        .logo-box {
            width: 72px; height: 72px; margin: 0 auto 20px;
            background: var(--primary-grad); border-radius: 24px;
            display: flex; align-items: center; justify-content: center;
            font-size: 32px; box-shadow: 0 10px 30px -5px rgba(59, 130, 246, 0.6);
        }
        h1 { font-size: 28px; font-weight: 800; letter-spacing: -0.5px; }
        p { color: var(--text-dim); margin-top: 10px; font-size: 15px; }

        /* FORM */
        .input-group { margin-bottom: 40px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .full-width { grid-column: span 2; }

        label { 
            display: block; font-size: 12px; font-weight: 600; color: var(--text-dim); 
            margin-bottom: 10px; margin-left: 5px; text-transform: uppercase; letter-spacing: 1px;
        }

        input, select {
            width: 100%; padding: 18px;
            background: var(--glass-bg-input);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: var(--text-light); font-size: 15px; outline: none;
            transition: all 0.3s ease;
        }
        input::placeholder { color: rgba(255,255,255,0.3); }
        input:focus, select:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
        }

        /* --- PERBAIKAN 1: SELECT ARROW --- */
        select { 
            appearance: none; 
            -webkit-appearance: none; 
            -moz-appearance: none;
            cursor: pointer;
            /* Icon Panah Putih SVG */
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            /* Calc 100% - 20px menjamin dia selalu di kanan */
            background-position: calc(100% - 20px) center;
            background-size: 18px;
            padding-right: 45px; /* Beri ruang agar teks tidak nabrak panah */
        }
        
        /* Opsi dropdown agar terlihat bagus di browser dark/light */
        select option {
            background-color: #1e293b;
            color: white;
            padding: 10px;
        }

        .btn-save {
            width: 100%; padding: 20px; margin-top: 15px;
            background: var(--primary-grad);
            color: white; font-weight: 700; font-size: 16px;
            border: none; border-radius: 22px; cursor: pointer;
            box-shadow: 0 20px 40px -10px rgba(59, 130, 246, 0.6);
            transition: all 0.3s;
        }
        .btn-save:hover { transform: translateY(-3px) scale(1.02); }
        /* Style saat tombol disabled/loading */
        .btn-save:disabled {
            opacity: 0.7; cursor: not-allowed; transform: none;
            background: #475569; /* Abu-abu saat loading */
            box-shadow: none;
        }

        /* LIST SECTION */
        .section-header {
            display: flex; justify-content: space-between; align-items: center;
            margin: 50px 0 25px; padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .section-title { font-size: 18px; font-weight: 700; color: var(--text-light); }
        .badge-count { background: rgba(255,255,255,0.1); padding: 6px 14px; border-radius: 30px; color: var(--text-dim); font-size: 12px; font-weight: 600; }

        .grid-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }

        .card {
            background: var(--glass-bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 28px;
            padding: 25px;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            display: flex; flex-direction: column;
        }
        .card:hover { 
            transform: translateY(-7px); 
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .card-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .keyword-pill { 
            background: rgba(59, 130, 246, 0.2); color: #93c5fd; 
            padding: 8px 14px; border-radius: 16px; font-size: 11px; font-weight: 700; 
        }
        .status-badge { font-size: 12px; font-weight: 600; display: flex; align-items: center; }
        .status-dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .st-Active { color: var(--success); } .st-Active .status-dot { background: var(--success); box-shadow: 0 0 10px var(--success); }
        .st-Done { color: var(--text-dim); } .st-Done .status-dot { background: var(--text-dim); }

        .card h3 { color: var(--text-light); margin-bottom: 10px; font-size: 17px; font-weight: 700; }
        .source { color: var(--text-dim); font-size: 13px; flex-grow: 1; margin-bottom: 30px; display: flex; align-items: center; gap: 8px; }

        .action-row { display: flex; gap: 15px; }
        .btn-link {
            flex: 1; text-decoration: none; text-align: center;
            background: rgba(255, 255, 255, 0.08); color: var(--text-light);
            padding: 14px; border-radius: 18px; font-weight: 600; font-size: 14px;
            transition: 0.3s; border: 1px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-link:hover { background: rgba(255, 255, 255, 0.15); border-color: rgba(255,255,255,0.3); }
        
        .btn-delete {
            width: 50px; height: 50px; flex-shrink: 0;
            background: var(--danger-glass); color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 18px; font-size: 18px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.3s;
        }
        .btn-delete:hover { background: rgba(239, 68, 68, 0.4); transform: scale(1.1); color: #fff; }

        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            .full-width { grid-column: span 1; }
            .container { padding: 30px 20px; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="logo-box"><i class="fas fa-cube"></i></div>
        <h1>Airdrop Vault</h1>
        <p>Private Automation Dashboard</p>
    </header>

    <div class="input-group">
        <form id="addForm">
            <div class="form-grid">
                <div class="full-width">
                    <label>Nama Project</label>
                    <input type="text" id="name" placeholder="Contoh: Avon Public Testnet" required>
                </div>
                <div>
                    <label>Keyword Bot</label>
                    <input type="text" id="keyword" placeholder="Contoh: Avon" required>
                </div>
                <div>
                    <label>Source ID</label>
                    <input type="text" id="source" placeholder="airdropfinder" required>
                </div>
                <div class="full-width">
                    <label>Link Garapan</label>
                    <input type="url" id="link" placeholder="https://..." required>
                </div>
                <div class="full-width">
                    <label>Status</label>
                    <select id="status">
                        <option value="Active">Active (Tracking)</option>
                        <option value="Done">Done (Arsip)</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="btn-save">
                <i class="fas fa-save" style="margin-right: 8px;"></i> Simpan Data
            </button>
        </form>
    </div>

    <div class="section-header">
        <span class="section-title">Monitoring List</span>
        <span class="badge-count" id="totalCount">0 Items</span>
    </div>
    
    <div id="gridList" class="grid-list">
        <div style="grid-column:1/-1; text-align:center; padding:60px; color:var(--text-dim); display:flex; flex-direction:column; align-items:center; gap:15px;">
            <i class="fas fa-circle-notch fa-spin" style="font-size: 32px; color: var(--primary-color);"></i>
            <span>Menghubungkan ke database...</span>
        </div>
    </div>
</div>

<script type="module">
    // --- CONFIG FIREBASE ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, query, orderBy } 
    from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDJwLno6mR7X1MNHyn3gRYagduOohmgcWQ",
  authDomain: "cryptodelonix.firebaseapp.com",
  projectId: "cryptodelonix",
  storageBucket: "cryptodelonix.firebasestorage.app",
  messagingSenderId: "265190187840",
  appId: "1:265190187840:web:86be6be1e4eac1aa70d0a5",
  measurementId: "G-BSSFE27WZ5"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- RENDER DATA ---
    const q = query(collection(db, "airdrops"), orderBy("createdAt", "desc"));
    
    onSnapshot(q, (snapshot) => {
        const grid = document.getElementById('gridList');
        const badge = document.getElementById('totalCount');
        
        grid.innerHTML = ""; badge.innerText = snapshot.size + " Items";

        if(snapshot.empty){
            grid.innerHTML = `
            <div style="grid-column:1/-1; text-align:center; padding:60px 40px; color:var(--text-dim); background:var(--glass-bg-card); border-radius:28px; border:1px solid var(--glass-border); display:flex; flex-direction:column; align-items:center; gap:20px;">
                <i class="fas fa-folder-open" style="font-size: 48px; opacity:0.5;"></i>
                <div>
                    <h4 style="color:var(--text-light); font-size:18px; margin-bottom:5px;">Belum ada data</h4>
                    <p>Mulai tambahkan garapan baru di atas.</p>
                </div>
            </div>`;
            return;
        }

        snapshot.forEach((documentSnapshot) => {
            const data = documentSnapshot.data();
            const docId = documentSnapshot.id;
            const searchKey = data.search_keyword || data.name;

            const card = document.createElement('div');
            card.className = 'card';
            
            card.innerHTML = `
                <div class="card-top">
                    <span class="keyword-pill"><i class="fas fa-robot" style="margin-right:6px;"></i>${searchKey}</span>
                    <div class="status-badge ${data.status === 'Active'?'st-Active':'st-Done'}">
                        <span class="status-dot"></span>${data.status}
                    </div>
                </div>
                
                <h3>${data.name}</h3>
                <div class="source"><i class="fab fa-telegram-plane" style="color:var(--primary-color);"></i> @${data.source}</div>
                
                <div class="action-row">
                    <a href="${data.link}" target="_blank" class="btn-link">
                        Buka Link <i class="fas fa-external-link-alt" style="margin-left:6px; font-size:12px;"></i>
                    </a>
                    </div>
            `;

            const delBtn = document.createElement('button');
            delBtn.className = 'btn-delete';
            delBtn.innerHTML = '<i class="far fa-trash-alt"></i>';
            delBtn.onclick = async () => {
                if(confirm(`Hapus ${data.name}?`)) await deleteDoc(doc(db, "airdrops", docId));
            };

            card.querySelector('.action-row').appendChild(delBtn);
            grid.appendChild(card);
        });
    });

    // --- PERBAIKAN 2: SUBMIT BUTTON LOGIC ---
    document.getElementById('addForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.querySelector('.btn-save');
        
        // Simpan teks asli
        const originalHtml = '<i class="fas fa-save" style="margin-right: 8px;"></i> Simpan Data';
        
        // Ubah jadi loading
        btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Menyimpan...'; 
        btn.disabled = true;

        try {
            await addDoc(collection(db, "airdrops"), {
                name: document.getElementById('name').value,
                search_keyword: document.getElementById('keyword').value.trim(),
                source: document.getElementById('source').value.replace('@','').trim(),
                link: document.getElementById('link').value,
                status: document.getElementById('status').value,
                createdAt: new Date(),
                last_message_snippet: "", tracked_msg_id: null 
            });
            
            // RESET FORM SETELAH SUKSES
            e.target.reset();

            // UBAH TOMBOL JADI SUKSES SEBENTAR
            btn.innerHTML = '<i class="fas fa-check"></i> Berhasil!';
            btn.style.background = "var(--success)";
            
            // KEMBALIKAN KE ASAL SETELAH 2 DETIK
            setTimeout(() => {
                btn.innerHTML = originalHtml;
                btn.disabled = false;
                btn.style.background = "var(--primary-grad)";
            }, 2000);

        } catch(err) { 
            alert("Error: " + err.message);
            // Kalo error langsung balik
            btn.innerHTML = originalHtml;
            btn.disabled = false;
        }
    });
</script>

</body>
</html>
